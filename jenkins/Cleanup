def commonVars = load 'common/variables.groovy'



pipeline {
    agent {
        node {
            label 'iacdipl-7'
        }
    }
    stages {
        stage('Cleanup HTTPS-Server') {
            steps {
                sh """
                python3 scripts/cleanup_data_server.py --path ${commonVars.publicDataPath} --threshold 7 --exclude ${commonVars.publicDataPath}/file_index
                """
            }
        }
        stage('Delete All Non-Running Containers') {
            steps {
                sh """
                podman container prune -f
                """
            }
        }
        stage('Delete All Unused Images') {
            steps {
                sh """
                podman image prune -f
                """
            }
        }
        stage('Delete All Unused Layers') {
            steps {
                sh """
                podman system prune -f
                """
            }
        }
    }
    post {
        always {
            deleteDir()
        }
    }
}
